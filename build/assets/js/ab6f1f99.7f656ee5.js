"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[5388],{7932:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});var r=s(7624),a=s(2172);const t={},c=void 0,i={id:"Reference/Misc/WLJSTransport",title:"WLJSTransport",description:"WLJSTransportScript",source:"@site/docs/Reference/Misc/WLJSTransport.md",sourceDirName:"Reference/Misc",slug:"/Reference/Misc/WLJSTransport",permalink:"/wlx-docs/docs/Reference/Misc/WLJSTransport",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1708366829,formattedLastUpdatedAt:"Feb 19, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Promise",permalink:"/wlx-docs/docs/Reference/Misc/Promise"},next:{title:"WLX",permalink:"/wlx-docs/docs/Reference/WLX/"}},l={},o=[{value:"<code>WLJSTransportScript</code>",id:"wljstransportscript",level:2},{value:"Example",id:"example",level:3},{value:"<code>WLJSTransportHandler</code>",id:"wljstransporthandler",level:2},{value:"Symbols tracking",id:"symbols-tracking",level:3},{value:"<code>$Client</code>",id:"client",level:2},{value:"<code>WLJSTransportSend</code>",id:"wljstransportsend",level:2},{value:"Example",id:"example-1",level:3},{value:"<code>Offload</code>",id:"offload",level:2},{value:"Example",id:"example-2",level:3},{value:"<code>server</code>",id:"server",level:2},{value:"<code>.socket</code>",id:"socket",level:3},{value:"<code>.send(message)</code>",id:"sendmessage",level:3},{value:"<code>.emitt(uid, message, topic=&#39;Default&#39;)</code>",id:"emittuid-message-topicdefault",level:3},{value:"<code>.ask(message)</code>",id:"askmessage",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:"<<JerryI`Misc`WLJS`Transport`\n"})}),"\n",(0,r.jsx)(n.h2,{id:"wljstransportscript",children:(0,r.jsx)(n.code,{children:"WLJSTransportScript"})}),"\n",(0,r.jsx)(n.p,{children:"A helper function to set up a WebSocket connection to a server from a page. It should be placed and executed in the head section of a page"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:"WLJSTransportScript[opts__] __String\n"})}),"\n",(0,r.jsx)(n.p,{children:"There are several options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"Port" -> _Integer'})," (",(0,r.jsx)(n.em,{children:"required"}),") specifies a port of WebSocket server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"Event" -> _String'})," an string identifier of an arbitrary ",(0,r.jsx)(n.a,{href:"/wlx-docs/docs/Reference/Misc/Events#%60EventObject%60",children:(0,r.jsx)(n.code,{children:"EventObject"})})," on a server. Once connection established it will fire an event with ",(0,r.jsx)(n.code,{children:'"Connected"'})," topic or pattern."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.p,{children:"In the header section of your page, put this line"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"<head>\n\t...\n\t<WLJSTransportScript Port={yourPort}/>\n</head>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"wljstransporthandler",children:(0,r.jsx)(n.code,{children:"WLJSTransportHandler"})}),"\n",(0,r.jsxs)(n.p,{children:["A handler function for ",(0,r.jsx)(n.code,{children:"WebSocketHandler"})," transport, that evaluates the requests from an WL interpreter running on client's side and provides features of symbols tracking."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:"WLJSTransportHandler\n"})}),"\n",(0,r.jsx)(n.p,{children:"an entry point for evaluation requests, connect it to your chain of handlers as follows"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:'ws = WebSocketHandler[]\nws["MessageHandler", "Evaluate"] = Function[True] -> WLJSTransportHandler\n'})}),"\n",(0,r.jsx)(n.h3,{id:"symbols-tracking",children:"Symbols tracking"}),"\n",(0,r.jsx)(n.p,{children:"To use this feature one need to specify a few more down-values"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:'WLJSTransportHandler["AddTracking"] = Function[{symbol, name, cli, callback},\n    Print["Add tracking... for "<>name];\n    Experimental`ValueFunction[Unevaluated[symbol]] = Function[{y,x}, callback[cli, x]];\n, HoldFirst]\n\nWLJSTransportHandler["GetSymbol"] = Function[{expr, client, callback},\n    Print["Evaluating the desired symbol on the Kernel"];\n    callback[expr // ReleaseHold];\n]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["After that you can freely use ",(0,r.jsx)(n.a,{href:"#%60Offload%60",children:(0,r.jsx)(n.code,{children:"Offload"})})," to dynamically bind symbols from server to pages."]}),"\n",(0,r.jsx)(n.h2,{id:"client",children:(0,r.jsx)(n.code,{children:"$Client"})}),"\n",(0,r.jsx)(n.p,{children:"A global object, that specifies a connected client"}),"\n",(0,r.jsx)(n.h2,{id:"wljstransportsend",children:(0,r.jsx)(n.code,{children:"WLJSTransportSend"})}),"\n",(0,r.jsx)(n.p,{children:"Submits an arbitrary WL expression to WL interpreter running in a browser using WebSockets"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:"WLJSTransportSend[expr_, client_] _\n"})}),"\n",(0,r.jsx)(n.p,{children:"A set of expression possible to be evaluated depends on WLJS Interpreter, its imported libraries and defined function on a page as well."}),"\n",(0,r.jsxs)(n.p,{children:["An identifier of a client can be retrieved  using global symbol ",(0,r.jsx)(n.code,{children:"$Client"})," in the context of fired ",(0,r.jsx)(n.code,{children:'"Connected"'})," (see ",(0,r.jsx)(n.a,{href:"#%60WLJSTransportScript%60",children:(0,r.jsx)(n.code,{children:"WLJSTransportScript"})})," ",(0,r.jsx)(n.code,{children:"Event"}),") event or other events from buttons or other UI elements."]}),"\n",(0,r.jsx)(n.h3,{id:"example-1",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["Once you know a connected client using ",(0,r.jsx)(n.code,{children:"$Client"})," try to evaluate"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:'WLJSTransportSend[Alert["Hello World"], client]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"offload",children:(0,r.jsx)(n.code,{children:"Offload"})}),"\n",(0,r.jsxs)(n.p,{children:["A key-expression with ",(0,r.jsx)(n.code,{children:"HoldFirst"})," attribute, that holds an expression to be interpreted on browser's side"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:"Offload[expr_] _\n"})}),"\n",(0,r.jsx)(n.p,{children:"Usually comes handy with automatic symbol binding between server and client, since an unknown symbol for a client is requested from server and then, interpreter subscribes for any changes of it."}),"\n",(0,r.jsx)(n.h3,{id:"example-2",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["Prepare your page and server as its shown in guide ",(0,r.jsx)(n.a,{href:"/wlx-docs/docs/WLX/dynamics",children:"dynamics"}),", attach symbols tracking as mentioned in ",(0,r.jsx)(n.a,{href:"#%60WLJSTransportHandler%60",children:(0,r.jsx)(n.code,{children:"WLJSTransportHandler"})})," and then"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",metastring:'title="App.wlx"',children:'pts = {{0,0}};\nGraph = Graphics[Point[Offload @ pts], PlotRange -> {{-1,1}, {-1,1}}];\n\ntask = SessionSubmit[ScheduledTask[pts = Append[pts, Last[pts] + 0.25 RandomReal[{-1,1}, 2]], Quantity[0.3, "Seconds"]]];\n\n<div class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">\n    <WLJS><Graph/></WLJS>\n</div>\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["Created ",(0,r.jsx)(n.code,{children:"task"})," will continue to run in the background. One need to detect closed connection and remove in manually. See tutorials."]})}),"\n",(0,r.jsx)(n.h2,{id:"server",children:(0,r.jsx)(n.code,{children:"server"})}),"\n",(0,r.jsxs)(n.p,{children:["A global Javascript object that represents server and created by ",(0,r.jsx)(n.a,{href:"#%60WLJSTransportScript%60",children:(0,r.jsx)(n.code,{children:"WLJSTransportScript"})}),"\nThere are several methods available for communication"]}),"\n",(0,r.jsx)(n.h3,{id:"socket",children:(0,r.jsx)(n.code,{children:".socket"})}),"\n",(0,r.jsxs)(n.p,{children:["A connected ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket",children:"WebSocket object"})]}),"\n",(0,r.jsx)(n.h3,{id:"sendmessage",children:(0,r.jsx)(n.code,{children:".send(message)"})}),"\n",(0,r.jsx)(n.p,{children:"Send a message for evaluation (async)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"server.send('Echo[\"Hi from sockets!\"]')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"emittuid-message-topicdefault",children:(0,r.jsx)(n.code,{children:".emitt(uid, message, topic='Default')"})}),"\n",(0,r.jsxs)(n.p,{children:["Emits an event on server's side with a given string identifier of ",(0,r.jsx)(n.code,{children:"EventObject"}),". To capture an event one have to subscribe to it using"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"server.emitt('uid', '1+1', 'Topic');\n"})}),"\n",(0,r.jsx)(n.p,{children:"and on server's side"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:'EventHandler["uid", {"Topic" -> Function[data,\n\tPrint[data];\n]}]\n'})}),"\n",(0,r.jsx)(n.p,{children:"or an omni listener"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mathematica",children:'EventHandler["uid", Function[data,\n\tPrint[data];\n]]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"askmessage",children:(0,r.jsx)(n.code,{children:".ask(message)"})}),"\n",(0,r.jsxs)(n.p,{children:["Asynchronously evaluates a message on a server and returns ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",children:"Promise"})," object"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const data = await server.ask('RandomReal[{-1,1}, 100]');\nconst result = await interpretate(data, {});\nconsole.log(result);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>i,M:()=>c});var r=s(1504);const a={},t=r.createContext(a);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);